!function(e){function t(t){for(var n,o,r=t[0],s=t[1],a=0,l=[];a<r.length;a++)o=r[a],i[o]&&l.push(i[o][0]),i[o]=0;for(n in s)Object.prototype.hasOwnProperty.call(s,n)&&(e[n]=s[n]);for(d&&d(t);l.length;)l.shift()()}var n={},i={0:0};var o={};var r={2:function(){return{"./ball_wasm":{__wbg_sqrt_6ac1ec864938feb9:function(e){return n[1].exports.__wbg_sqrt_6ac1ec864938feb9(e)},__wbg_random_918d3291fe65513c:function(){return n[1].exports.__wbg_random_918d3291fe65513c()},__widl_f_begin_path_CanvasRenderingContext2D:function(e){return n[1].exports.__widl_f_begin_path_CanvasRenderingContext2D(e)},__widl_f_fill_CanvasRenderingContext2D:function(e){return n[1].exports.__widl_f_fill_CanvasRenderingContext2D(e)},__widl_f_set_fill_style_CanvasRenderingContext2D:function(e,t){return n[1].exports.__widl_f_set_fill_style_CanvasRenderingContext2D(e,t)},__widl_f_arc_CanvasRenderingContext2D:function(e,t,i,o,r,s,a){return n[1].exports.__widl_f_arc_CanvasRenderingContext2D(e,t,i,o,r,s,a)},__widl_f_close_path_CanvasRenderingContext2D:function(e){return n[1].exports.__widl_f_close_path_CanvasRenderingContext2D(e)},__widl_f_clear_rect_CanvasRenderingContext2D:function(e,t,i,o,r){return n[1].exports.__widl_f_clear_rect_CanvasRenderingContext2D(e,t,i,o,r)},__wbindgen_number_get:function(e,t){return n[1].exports.__wbindgen_number_get(e,t)},__wbindgen_string_get:function(e,t){return n[1].exports.__wbindgen_string_get(e,t)},__wbindgen_boolean_get:function(e){return n[1].exports.__wbindgen_boolean_get(e)},__wbindgen_is_null:function(e){return n[1].exports.__wbindgen_is_null(e)},__wbindgen_is_undefined:function(e){return n[1].exports.__wbindgen_is_undefined(e)},__wbindgen_is_symbol:function(e){return n[1].exports.__wbindgen_is_symbol(e)},__wbindgen_throw:function(e,t){return n[1].exports.__wbindgen_throw(e,t)}}}}};function s(t){if(n[t])return n[t].exports;var i=n[t]={i:t,l:!1,exports:{}};return e[t].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.e=function(e){var t=[],n=i[e];if(0!==n)if(n)t.push(n[2]);else{var a=new Promise(function(t,o){n=i[e]=[t,o]});t.push(n[2]=a);var l,c=document.getElementsByTagName("head")[0],d=document.createElement("script");d.charset="utf-8",d.timeout=120,s.nc&&d.setAttribute("nonce",s.nc),d.src=function(e){return s.p+""+e+".bundle.js"}(e),l=function(t){d.onerror=d.onload=null,clearTimeout(u);var n=i[e];if(0!==n){if(n){var o=t&&("load"===t.type?"missing":t.type),r=t&&t.target&&t.target.src,s=new Error("Loading chunk "+e+" failed.\n("+o+": "+r+")");s.type=o,s.request=r,n[1](s)}i[e]=void 0}};var u=setTimeout(function(){l({type:"timeout",target:d})},12e4);d.onerror=d.onload=l,c.appendChild(d)}return({1:[2]}[e]||[]).forEach(function(e){var n=o[e];if(n)t.push(n);else{var i,a=r[e](),l=fetch(s.p+""+{2:"4a8755734d1624b5f8d7"}[e]+".module.wasm");if(a instanceof Promise&&"function"==typeof WebAssembly.compileStreaming)i=Promise.all([WebAssembly.compileStreaming(l),a]).then(function(e){return WebAssembly.instantiate(e[0],e[1])});else if("function"==typeof WebAssembly.instantiateStreaming)i=WebAssembly.instantiateStreaming(l,a);else{i=l.then(function(e){return e.arrayBuffer()}).then(function(e){return WebAssembly.instantiate(e,a)})}t.push(o[e]=i.then(function(t){return s.w[e]=(t.instance||t).exports}))}}),Promise.all(t)},s.m=e,s.c=n,s.d=function(e,t,n){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)s.d(n,i,function(t){return e[t]}.bind(null,i));return n},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s.oe=function(e){throw console.error(e),e},s.w={};var a=window.webpackJsonp=window.webpackJsonp||[],l=a.push.bind(a);a.push=t,a=a.slice();for(var c=0;c<a.length;c++)t(a[c]);var d=l;s(s.s=0)}([function(e,t,n){"use strict";n.r(t);const i=300;function o(){const e=[],t={width:window.innerWidth,height:window.innerHeight,mode:"wasm-compute-js-render-canvas",track:function(n){if("function"!=typeof n)throw new Error("Must be a function that will be called on window resize to update width / height");n(t),e.push(n)}},n=function(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>e.apply(this,i),t)}}(()=>{t.width=window.innerWidth,t.height=window.innerHeight,e.forEach(e=>{e(t)})},i);return window.addEventListener("resize",n,!1),{cleanup:()=>{window.removeEventListener("resize",n)},stage:t}}function r(e){const t=document.getElementById("root"),n=document.createElement("p"),i=document.createElement("button");i.innerText="SHUFFLE";const o=document.createElement("p");o.append(i);const r=function(){const e=document.createElement("div");return e.className="wasmCollection-compute-wasmCollection-render-html wasm-compute-wasm-render-html wasm-compute-js-render-html js-compute-js-render-html",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=-1,e}(),s=function(){const e=document.createElement("canvas");return e.className="wasmCollection-compute-wasmCollection-render-canvas wasm-compute-wasm-render-canvas wasm-compute-js-render-canvas js-compute-js-render-canvas",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=-1,e}();e.track(({width:e,height:t})=>{s.width=e,s.height=t}),e.track(({width:e,height:t})=>{r.style.width=`${e}px`,r.style.height=`${t}px`});const a=function(e=[],t){const n=e.map(e=>{const n=document.createElement("input");n.name="render-mode",n.type="radio",n.value=e.value,n.id=e.value,n.checked=t.mode===e.value,n.onchange=(e=>{[...document.getElementsByClassName(t.mode)].forEach(e=>e.style.display="none"),t.mode=e.target.value,[...document.getElementsByClassName(t.mode)].forEach(e=>e.style.display="block")});const i=document.createElement("label");i.innerText=e.label,i.htmlFor=e.value;const o=document.createElement("li");return o.appendChild(n),o.appendChild(i),o}),i=document.createElement("ul");n.forEach(e=>i.appendChild(e)),i.style.listStyle="none",i.style.paddingLeft="20px";const o=document.createElement("p");o.innerText="Choose an implementation between JavaScript and Rust/WASM:";const r=document.createElement("div");return r.appendChild(o),r.appendChild(i),r}([{value:"wasmCollection-compute-wasmCollection-render-canvas",label:"compute by WASM - render by WASM into canvas (iteration in WASM)"},{value:"wasmCollection-compute-wasmCollection-render-html",label:"compute by WASM - render by WASM into html (iteration in WASM)"},{value:"wasm-compute-wasm-render-canvas",label:"compute by WASM - render by WASM into canvas (iteration still in JS)"},{value:"wasm-compute-wasm-render-html",label:"compute by WASM - render by WASM into html (iteration still in JS)"},{value:"wasm-compute-js-render-canvas",label:"compute by WASM - render by JS into canvas"},{value:"wasm-compute-js-render-html",label:"compute by WASM - render by JS into html"},{value:"js-compute-js-render-canvas",label:"compute by JS - render by JS into canvas"},{value:"js-compute-js-render-html",label:"compute by JS - render by JS into html"}],e);return t.appendChild(a),t.appendChild(n),t.appendChild(o),t.appendChild(s),t.appendChild(r),{rootNode:t,infosNode:n,shuffleButton:i,canvasRenderNode:s,canvasCtx:s.getContext("2d"),htmlRenderNode:r}}class s{constructor(e,t){this.x=e,this.y=t}get_length(){return Math.sqrt(this.x*this.x+this.y*this.y)}dot(e){return this.x*e.x+this.y*e.y}normalize(){return new s(this.x/this.get_length(),this.y/this.get_length())}scale(e){return new s(this.x*e,this.y*e)}}var a=s;var l=class{constructor(e,t,n,i,o,r,s,a,l){this.x=e,this.y=t,this.velocity_x=n,this.velocity_y=i,this.radius=o,this.mass=r,this.gravity=s,this.elasticity=a,this.friction=l}step(){this.x=this.x+this.gravity*this.velocity_x,this.y=this.y+this.gravity*this.velocity_y,this.velocity_x=this.friction*this.velocity_x,this.velocity_y=this.friction*this.velocity_y}manageStageBorderCollision(e,t){this.x-this.radius<0&&(this.velocity_x=-this.velocity_x*this.elasticity,this.x=this.radius),this.x+this.radius>e&&(this.velocity_x=-this.velocity_x*this.elasticity,this.x=e-this.radius),this.y-this.radius<0&&(this.velocity_y=-this.velocity_y*this.elasticity,this.y=this.radius),this.y+this.radius>t&&(this.velocity_y=-this.velocity_y*this.elasticity,this.y=t-this.radius)}checkBallCollision(e){const t=this.x-e.x,n=this.y-e.y,i=this.radius+e.radius;return t*t+n*n<=i*i}resolveBallCollision(e){const t=this.get_vector_2d(e),n=t.get_length(),i=t.scale((this.radius+e.radius-n)/n),o=1/this.mass,r=1/e.mass,s=new a(this.velocity_x-e.velocity_x,this.velocity_y-e.velocity_y),l=i.normalize(),c=s.dot(l);if(c>0)return;const d=-1.85*c/(o+r),u=l.scale(d),h=u.scale(o),m=u.scale(r);this.velocity_x=(this.velocity_x+h.x)*this.elasticity,this.velocity_y=(this.velocity_y+h.y)*this.elasticity,e.velocity_x=(e.velocity_x-m.x)*this.elasticity,e.velocity_y=(e.velocity_y-m.y)*this.elasticity}setRandomPositionAndSpeedInBounds(e,t){this.x=this.random()*e,this.y=this.random()*t,this.velocity_x=10*this.random(),this.velocity_y=10*this.random()}get_vector_2d(e){return new a(this.x-e.x,this.y-e.y)}random(){return Math.random()}};const c=15,d=1.3,u=1,h=.98,m=1;n.e(1).then(n.bind(null,1)).then(e=>{function t({x:t=0,y:n=0,velocityX:i=0,velocityY:o=0,radius:r=c,mass:s=d,gravity:a=u,elasticity:_=h,friction:p=m,wasm:y=!0}={}){return new(y?e.Ball:l)(t,n,i,o,r,s,a,_,p)}function n(e){e.forEach(e=>e.step()),e.forEach(e=>e.manageStageBorderCollision(_.width,_.height));for(let t=0;t<e.length;t++)for(let n=t+1;n<e.length;n++)!0===e[t].checkBallCollision(e[n])&&e[t].resolveBallCollision(e[n])}function i(e,t,n="#900000"){t.fillStyle=n,t.beginPath(),t.arc(e.x,e.y,e.radius,0,2*Math.PI,!0),t.closePath(),t.fill()}function s(e,t="#900000"){return`<div class="ball" style="position:absolute;top:${e.y-e.radius}px;left:${e.x-e.radius}px;background:${t};width:${2*e.radius}px;height:${2*e.radius}px;border-radius:${e.radius}px"></div>`}const a={"wasmCollection-compute-wasmCollection-render-canvas":function(){b.wasmCollection.drawToCtx(y,"black",_.width,_.height)},"wasmCollection-compute-wasmCollection-render-html":function(){f.innerHTML=b.wasmCollection.drawToHtml("darkgrey")},"wasm-compute-wasm-render-canvas":function(){y.clearRect(0,0,_.width,_.height),b.wasm.forEach(t=>e.drawWasmBallToCtx(t,y,"purple"))},"wasm-compute-wasm-render-html":function(){f.innerHTML=b.wasm.map(t=>e.drawWasmBallToHtml(t,"green")).join("")},"wasm-compute-js-render-canvas":function(){y.clearRect(0,0,_.width,_.height),b.wasm.forEach(e=>i(e,y,"blue"))},"wasm-compute-js-render-html":function(){f.innerHTML=b.wasm.map(e=>s(e,"darkblue")).join("")},"js-compute-js-render-canvas":function(){y.clearRect(0,0,_.width,_.height),b.js.forEach(e=>i(e,y,"red"))},"js-compute-js-render-html":function(){f.innerHTML=b.js.map(e=>s(e,"darkred")).join("")}};const{stage:_}=o(),{infosNode:p,canvasCtx:y,htmlRenderNode:f,shuffleButton:w}=r(_);let v=0,g=0;const b={wasmCollection:(()=>{const t=new e.BallCollection;return t.fill(10,c,d,u,h,m),t})(),wasm:Array.from(Array(10),e=>t()),js:Array.from(Array(10),e=>t({wasm:!1}))},x=()=>{b.wasmCollection.setRandomPositionAndSpeedInBounds(_.width,_.height),console.log(b.wasmCollection.format()),b.wasm.forEach(e=>{e.setRandomPositionAndSpeedInBounds(_.width,_.height)}),b.js.forEach(e=>{e.setRandomPositionAndSpeedInBounds(_.width,_.height)})};w.onclick=x,x(),function e(t){requestAnimationFrame(e),v=t-g,b.wasmCollection.update(_.width,_.height),n(b.wasm),n(b.js),p.innerText=`Delta: ${v.toFixed(4)}ms - FrameRate: ${Math.round(1e3/v)} FPS`,a[_.mode](),g=t}()}).catch(e=>{const t=document.createElement("p");t.innerText="An error occured:";const n=document.createElement("pre");n.innerText=e.message;const i=document.getElementById("root");i.appendChild(t),i.appendChild(n)})}]);
//# sourceMappingURL=bundle.js.map